window.NPMAP3D=window.NPMAP3D||{},NPMAP3D.getScriptLocation=function(){function e(e){for(var t,i,r=new RegExp("(^|(.*?\\/))("+e+")(\\?|$)"),o=document.getElementsByTagName("script"),n="",a=0,s=o.length;a<s;a++)if(t=o[a].getAttribute("src"),t&&(i=t.match(r))){n=i[1];break}return n}var t=e("NPMAP3D.js");return window.CESIUM_BASE_URL=t+"lib/Cesium/",t},NPMAP3D.addCSSFiles=function(e){var t=NPMAP3D.getScriptLocation();if(e&&!(e.length<=0)){for(var i=[],r=0,o=e.length;r<o;r++)i.push("<link type='text/css' rel='stylesheet' href = '"+(""===t?e[r]:t+"/"+e[r])+"'/> ");i.length>0&&document.write(i.join(""))}},NPMAP3D.addJSFiles=function(e){if(e&&!(e.length<=0)){for(var t=NPMAP3D.getScriptLocation(),i=[],r=0,o=e.length;r<o;r++)i.push("<script type='text/javascript' src='"+(""===t?e[r]:t+"/"+e[r])+"'></script>");i.length>0&&document.write(i.join(""))}},function(){var e=["lib/Cesium/Widgets/widgets.css","css/NPMAP3D.css"],t=["lib/Cesium/Cesium.js","lib/Cesium/DrawHelper/DrawHelper.js","lib/Cesium/CesiumHeatmap.js"];NPMAP3D.addCSSFiles(e),NPMAP3D.addJSFiles(t)}(),NPMAP3D.StripeOrientation={HORIZONTAL:0,VERTICAL:1},NPMAP3D.CornerType={ROUNDED:0,MITERED:1,BEVELED:2},NPMAP3D.Static={},NPMAP3D.Static.HorizontalOrigin={CENTER:0,LEFT:1,RIGHT:-1},NPMAP3D.Static.LabelStyle={FILL:0,OUTLINE:1,FILL_AND_OUTLINE:2},NPMAP3D.Static.VerticalOrigin={CENTER:0,BOTTOM:1,TOP:-1},NPMAP3D.Static.HeightReference={NONE:0,CLAMP_TO_GROUND:1,RELATIVE_TO_GROUND:2},NPMAP3D.Building={},NPMAP3D.inherits=function(e,t){var i=t.prototype,r=e.prototype;for(var o in i)r[o]=i[o];r.uber=i,e.prototype.constructor=e},NPMAP3D.nullFunction=function(){},NPMAP3D.global=Function("return this")(),NPMAP3D.basemap=void 0,NPMAP3D.Color=function(){"use strict"},NPMAP3D.Color.fromRandom=function(e,t,i){return Cesium.Color.fromRandom({red:e,green:t,blue:i})},NPMAP3D.Color.fromCssColorString=function(e){return Cesium.Color.fromCssColorString(e)},NPMAP3D.Color.fromHsl=function(e,t,i,r){return Cesium.Color.fromHsl(e,t,i,r)},NPMAP3D.MAP3D=function(e,t){return NPMAP3D.Color.RED=Cesium.Color.RED,NPMAP3D.Color.GREEN=Cesium.Color.GREEN,NPMAP3D.Color.BLUE=Cesium.Color.BLUE,NPMAP3D.Color.WHITE=Cesium.Color.WHITE,NPMAP3D.Color.BLACK=Cesium.Color.BLACK,NPMAP3D.Color.YELLOW=Cesium.Color.YELLOW,NPMAP3D.Color.PURPLE=Cesium.Color.PURPLE,NPMAP3D.Color.GRAY=Cesium.Color.GRAY,NPMAP3D.Color.BROWN=Cesium.Color.BROWN,NPMAP3D.Color.BROWN=Cesium.Color.CORAL,NPMAP3D.NPUtil.webglSupport()?(t=NPMAP3D.NPUtil.extend(t,{scene3DOnly:!0,baseLayerPicker:!1,animation:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,selectionIndicator:!1,timeline:!1,navigationHelpButton:!1,navigationInstructionsInitiallyVisible:!1,infoBox:!1}),this.viewer=new Cesium.Viewer(e,t),this.viewer._cesiumWidget._creditContainer.style.display="none",this.events={},this.thematicMap=new NPMAP3D.HashMap,this.defaultBaseLayer(),this._setInputAction(),void this.flyToGlobal()):void alert("浏览器不支持 WebGL!")},NPMAP3D.MAP3D.prototype.defaultBaseLayer=function(){this.viewer.imageryLayers.removeAll();var e,t=NPMAP3D.NPUtil.getHost(),i=new NPMAP3D.Layer.GaoDeLayer(t+"lib/Cesium/Assets/basemap/{z}/{x}/{y}.jpg","AMAP_BASEMAP",{maximumLevel:7}),r=i.imageryLayers,o=0,n=r.length;for(o;o<n;o++)e=r[o],e._isBaseLayer=!0,this.viewer.imageryLayers.add(e);NPMAP3D.basemap=NPMAP3D.BaseMap.AMAP_ROAD},NPMAP3D.MAP3D.prototype.addEventLinsener=function(e,t){this.events[e]=t},NPMAP3D.MAP3D.prototype.removeEventLinsener=function(e){this.events[e]&&delete this.events[e]},NPMAP3D.MAP3D.prototype.addLayer=function(e){this.viewer.imageryLayers.add(e.imageryLayers[0]),2===e.imageryLayers.length&&this.viewer.imageryLayers.add(e.imageryLayers[1]),this.thematicMap.put(e.name,e)},NPMAP3D.MAP3D.prototype.addLayers=function(e){for(var t=0,i=e.length;t<i;t++)this.addLayer(e[t])},NPMAP3D.MAP3D.prototype.getLayerByName=function(e){var t;return this.thematicMap.containsKey(e)&&(t=this.thematicMap.get(e)),t},NPMAP3D.MAP3D.prototype.removeLayerByName=function(e){var t=this.getLayerByName(e);Cesium.defined(t)&&(this.viewer.imageryLayers.remove(t.imageryLayers[0]),this.thematicMap.removeByKey(e))},NPMAP3D.MAP3D.prototype.getAllLayers=function(){return this.thematicMap.values()},NPMAP3D.MAP3D.prototype.flyTo=function(e,t){var i,r;"undefined"==typeof t&&(t=!0),t?(i=NPMAP3D.NPCoordinate.coordinateTransByBasemap(e.lon,e.lat),r=Cesium.Cartesian3.fromDegrees(i.lon,i.lat,e.h)):r=e,this.viewer.camera.flyTo({destination:r,orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-90),roll:Cesium.Math.toRadians(0)},duration:6})},NPMAP3D.MAP3D.prototype.flyToGlobal=function(){this.flyTo(new Cesium.Cartesian3((-4973612.332917644),18613935.882409602,12937149.478224985),!1)},NPMAP3D.MAP3D.prototype.setLighting=function(e){this.viewer.scene.globe.enableLighting=e},NPMAP3D.MAP3D.prototype.addOverlayLayer=function(e){if(!Cesium.defined(e))throw new NPMAP3D.DeveloperError("MAP3D","addOverlayLayer() 参数 overlayLayer 没有定义!");this.viewer.dataSources.add(e.dataSource)},NPMAP3D.MAP3D.prototype.removeOverlayLayer=function(e){if(!Cesium.defined(e))throw new NPMAP3D.DeveloperError("MAP3D","removeOverlayLayer() 参数 overlayLayer 没有定义!");if(this.viewer.dataSources.contains(e.dataSource)&&!this.viewer.dataSources.remove(e.dataSource,!0))throw new NPMAP3D.DeveloperError("MAP3D","removeOverlayLayer() 失败!")},NPMAP3D.MAP3D.prototype.getCenter=function(){var e=this.viewer.container.offsetWidth,t=this.viewer.container.offsetHeight,i=new Cesium.Cartesian2(e/2,t/2),r=this.viewer.scene.camera.pickEllipsoid(i,Cesium.Ellipsoid.WGS84);return NPMAP3D.NPCoordinate.cartesianToPointGeo(r)},NPMAP3D.MAP3D.prototype.setCenter=function(e,t,i){this.viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(e.x||e.lon,e.y||e.lat,e.z||e.h),complete:t,cancel:i})},NPMAP3D.MAP3D.prototype.getWindowCoordinates=function(e){var t=Cesium.Cartesian3.fromDegrees(e.x||e.lon,e.y||e.lat),i=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,t);return{x:i.x,y:i.y}},NPMAP3D.MAP3D.prototype._setInputAction=function(){var e=this,t=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),i=void 0,r=void 0;t.setInputAction(function(t){try{if("undefined"!=typeof i){var o=i._id;Cesium.defined(o)&&o.indexOf("building")!==-1&&i.polygon&&(i.polygon.material=r),i=void 0,r=void 0}if(i=e.viewer.selectedEntity,!i){var n=e.events.click;if(n&&n instanceof Function){var a=e.viewer.scene.camera.pickEllipsoid(t.position,Cesium.Ellipsoid.WGS84),s=NPMAP3D.NPCoordinate.cartesianToPointGeo(a);n(s)}return}var l=i._id;if(Cesium.defined(l)&&l.indexOf("building")!==-1){var P=i.polygon;P&&(r=P.material,P.material=Cesium.Color.PURPLE)}if(i.overlay&&i.overlay.events.click&&i.overlay.events.click instanceof Function){var u=i.overlay.events.click;u(i.overlay)}}catch(h){throw new NPMAP3D.DeveloperError("NPMAP3D.MAP3D entityClickHandler",h)}},Cesium.ScreenSpaceEventType.LEFT_CLICK)},NPMAP3D.MAP3D.prototype.destroy=function(){this.viewer=null,this.events=null,this.thematicMap=null},NPMAP3D.NPUtil=function(){},NPMAP3D.NPUtil.webglSupport=function(){var e=!0;try{var t=document.createElement("canvas");e=!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(i){e=!1}return e},NPMAP3D.NPUtil.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},NPMAP3D.NPUtil.isObject=function(e){return"[object Object]"==={}.toString.apply(e)},NPMAP3D.NPUtil.isFunction=function(e){var t={};return e&&"[object Function]"==t.toString.call(e)},NPMAP3D.NPUtil.isBoolean=function(e){return"boolean"==typeof e},NPMAP3D.NPUtil.isNum=function(e){return!isNaN(e)},NPMAP3D.NPUtil.hexToRgb=function(e){var t,i,r;if(/^#/g.test(e))return t=e.slice(1,3),i=e.slice(3,5),r=e.slice(5,7),[parseInt(t,16),parseInt(i,16),parseInt(r,16)];throw new NPMAP3D.DeveloperError("NPMAP3D.NPUtil.hexToRgb","hexToRgb 16进制颜色格式不正确!")},NPMAP3D.NPUtil.rgb2hex=function(e){for(var t=e[0],i=e[1],r=e[2],o=65536*Number(t)+256*Number(i)+Number(r),n=o.toString(16);n.length<6;)n="0"+n;return"#"+n},NPMAP3D.NPUtil.getRandomColor=function(){return"#"+(16777215*Math.random()<<0).toString(16)},NPMAP3D.NPUtil.StringTrim=function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},NPMAP3D.NPUtil.StringLtrim=function(e){return e.replace(/(^\s*)/g,"")},NPMAP3D.NPUtil.StringRtrim=function(e){return e.replace(/(\s*$)/g,"")},NPMAP3D.NPUtil.UUID=function(){var e,t,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),o=0;for(t=0;t<36;t++)8==t||13==t||18==t||23==t?r[t]="-":14==t?r[t]="4":(o<=2&&(o=33554432+16777216*Math.random()|0),e=15&o,o>>=4,r[t]=i[19==t?3&e|8:e]);return r.join("")},NPMAP3D.NPUtil.getHost=function(){function e(e){for(var t,i,r=new RegExp("(^|(.*?\\/))("+e+")(\\?|$)"),o=document.getElementsByTagName("script"),n="",a=0,s=o.length;a<s;a++)if(t=o[a].getAttribute("src"),t&&(i=t.match(r))){n=i[1];break}return n}return e("NPMAP3D.js")},NPMAP3D.NPUtil.forwardMercator=function(e){var t=20037508.34,i={x:e.x,y:e.y};i.x=i.x*t/180;var r=Math.log(Math.tan((90+i.y)*Math.PI/360))/Math.PI*t;return i.y=Math.max(-20037508.34,Math.min(r,20037508.34)),i},NPMAP3D.NPUtil.distinct=function(e,t){var i=NPMAP3D.NPUtil.forwardMercator(e),r=NPMAP3D.NPUtil.forwardMercator(t);return Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y))},NPMAP3D.NPUtil.clone=function(e,t){if(null==e||"object"!=typeof e)return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);t=t||new e.constructor;for(var i in e)t[i]="undefined"==typeof t[i]?NPMAP3D.NPUtil.clone(e[i],null):t[i];return t},NPMAP3D.NPUtil.extend=function(e,t){e=e||{};for(var i in t)void 0===e[i]&&(e[i]=NPMAP3D.NPUtil.clone(t[i]));return e},NPMAP3D.NPUtil=NPMAP3D.NPUtil||{},NPMAP3D.NPUtil.rad=function(e){return e*Math.PI/180},NPMAP3D.NPUtil.getGeodesicArea=function(e){var t=0,i=e.length;if(i>2){for(var r=0;r<i-1;r++)p1=e[r],p2=e[r+1],t+=NPMAP3D.NPUtil.rad(p2.x-p1.x)*(2+Math.sin(NPMAP3D.NPUtil.rad(p1.y))+Math.sin(NPMAP3D.NPUtil.rad(p2.y)));t=6378137*t*6378137/2}return t},NPMAP3D.NPUtil.getArea=function(e){var t=0,i=e.length;if(i>2){var r=0,o=e[0];o=_3dhelper.degreeToWebMoctor(o.x,o.y);for(var n=1;n<i-1;n++){var a=e[n],s=e[n+1];a=_3dhelper.degreeToWebMoctor(a.x,a.y),s=_3dhelper.degreeToWebMoctor(s.x,s.y),r+=(a.lon-o.lon)*(s.lat-o.lat)-(a.lat-o.lat)*(s.lon-o.lon)}t=Math.abs(r)/2}return t},NPMAP3D.NPUtil.CoordinateHelper=function(){};var pi=3.141592653589793,ee=.006693421622965943,x_pi=52.35987755982988,pole=20037508.34,a=6378245,_3dhelper={degreeToWebMoctor:function(e,t){var i,r={lon:0,lat:0};return e=parseFloat(e),t=parseFloat(t),r.lon=e/180*20037508.34,t>85.05112&&(t=85.05112),t<-85.05112&&(t=-85.05112),t=Math.PI/180*t,i=Math.PI/4+t/2,r.lat=20037508.34*Math.log(Math.tan(i))/Math.PI,r},webMoctorToDegree:function(e,t){return e=180*e/pole,t=180/Math.PI*(2*Math.atan(Math.exp(t/pole*Math.PI))-Math.PI/2),{lon:e,lat:t}},gcjTowgs84:function(e,t){var i={lon:0,lat:0},r=e-(_3dhelper.wgs84ToGcj(e,t).lon-e),o=t-(_3dhelper.wgs84ToGcj(e,t).lat-t);return i.lon=r,i.lat=o,i},encryptToBd:function(e,t){var i=e,r=t,o=Math.sqrt(i*i+r*r)+2e-5*Math.sin(r*x_pi),n=Math.atan2(r,i)+3e-6*Math.cos(i*x_pi),a=o*Math.cos(n)+.0065,s=o*Math.sin(n)+.006;return{lon:a,lat:s}},bdTodecrypt:function(e,t){var i=e-.0065,r=t-.006,o=Math.sqrt(i*i+r*r)-2e-5*Math.sin(r*x_pi),n=Math.atan2(r,i)-3e-6*Math.cos(i*x_pi),a=o*Math.cos(n),s=o*Math.sin(n);return{lon:a,lat:s}},wgs84ToGcj:function(e,t){var i,r,o,n,s,l,P,u={};return e=parseFloat(e),t=parseFloat(t),this.outofChina(t,e)?(u.lon=e,u.lat=t,u):(i=_3dhelper.transformLat(e-105,t-35),r=_3dhelper.transformLon(e-105,t-35),o=t/180*pi,n=Math.sin(o),n=1-ee*n*n,s=Math.sqrt(n),i=180*i/(a*(1-ee)/(n*s)*pi),r=180*r/(a/s*Math.cos(o)*pi),l=t+i,P=e+r,u.lon=P,u.lat=l,u)},outofChina:function(e,t){return t<72.004||t>137.8347||(e<.8293||e>55.8271)},transformLat:function(e,t){var i=-100+2*e+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*pi)+20*Math.sin(2*e*pi))/3,i+=2*(20*Math.sin(t*pi)+40*Math.sin(t/3*pi))/3,i+=2*(160*Math.sin(t/12*pi)+320*Math.sin(t*pi/30))/3},transformLon:function(e,t){var i=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*pi)+20*Math.sin(2*e*pi))/3,i+=2*(20*Math.sin(e*pi)+40*Math.sin(e/3*pi))/3,i+=2*(150*Math.sin(e/12*pi)+300*Math.sin(e/30*pi))/3}};NPMAP3D.NPUtil.CoordinateHelper.coordinateTransByBasemap=function(e,t){var i=NPMAP3D.basemap;if("undefined"==typeof i)throw new NPMAP3D.DeveloperError("coordinateTransByBasemap","底图类型不确定!");var r={lon:0,lat:0};switch(i){case NPMAP3D.BaseMap.AMAP_ROAD:r=_3dhelper.wgs84ToGcj(e,t);break;case NPMAP3D.BaseMap.AMAP_AERIAL:r=_3dhelper.wgs84ToGcj(e,t);break;case NPMAP3D.BaseMap.GOOGLE_AERIAL:r=_3dhelper.wgs84ToGcj(e,t);break;case NPMAP3D.BaseMap.GOOGLE_ROAD:r=_3dhelper.wgs84ToGcj(e,t);break;case NPMAP3D.BaseMap.BING_AERIAL:break;case NPMAP3D.BaseMap.BING_AERIAL_WITH_LABELS:break;case NPMAP3D.BaseMap.BING_ROAD:break;case NPMAP3D.BaseMap.BING_ORDNANCE_SURVEY:break;case NPMAP3D.BaseMap.BING_COLLINS_BART:break;default:r.lon=e,r.lat=t}return r},NPMAP3D.NPUtil.CoordinateHelper.coordinateFromBasemap=function(e,t){var i=NPMAP3D.basemap;if("undefined"==typeof i)throw new NPMAP3D.DeveloperError("coordinateTransByBasemap","底图类型不确定!");var r={lon:0,lat:0};switch(i){case NPMAP3D.BaseMap.AMAP_ROAD:r=_3dhelper.gcjTowgs84(e,t);break;case NPMAP3D.BaseMap.AMAP_AERIAL:r=_3dhelper.gcjTowgs84(e,t);break;case NPMAP3D.BaseMap.GOOGLE_AERIAL:r=_3dhelper.gcjTowgs84(e,t);break;case NPMAP3D.BaseMap.GOOGLE_ROAD:r=_3dhelper.gcjTowgs84(e,t);break;case NPMAP3D.BaseMap.BING_AERIAL:break;case NPMAP3D.BaseMap.BING_AERIAL_WITH_LABELS:break;case NPMAP3D.BaseMap.BING_ROAD:break;case NPMAP3D.BaseMap.BING_ORDNANCE_SURVEY:break;case NPMAP3D.BaseMap.BING_COLLINS_BART:break;default:r.lon=e,r.lat=t}return r},NPMAP3D.NPCoordinate=function(){},NPMAP3D.NPCoordinate.coordinateTransByBasemap=function(e,t){return NPMAP3D.NPUtil.CoordinateHelper.coordinateTransByBasemap(e,t)},NPMAP3D.NPCoordinate.cartesianToPointGeo=function(e){var t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(e),i=Cesium.Math.toDegrees(t.longitude),r=Cesium.Math.toDegrees(t.latitude),o=NPMAP3D.NPUtil.CoordinateHelper.coordinateFromBasemap(i,r),n=new NPMAP3D.Geometry.Point3D(o.lon,o.lat,t.height);return n},NPMAP3D.NPCoordinate.positionsToPolylineGeo=function(e){var t,i,r,o,n=e.length,a=new Array;for(t=0;t<n;t++)i=e[t],r=NPMAP3D.NPCoordinate.cartesianToPointGeo(i),a.push(r);return o=new NPMAP3D.Geometry.Polyline([a])},NPMAP3D.NPCoordinate.positionsToPolygonGeo=function(e){var t,i,r,o,n=e.length,a=new Array;for(t=0;t<n;t++)i=e[t],r=NPMAP3D.NPCoordinate.cartesianToPointGeo(i),a.push(r);return o=new NPMAP3D.Geometry.Polygon([a])},NPMAP3D.NPCoordinate.extentToExtentGeo=function(e){var t=Cesium.Rectangle.northwest(e,t),i=Cesium.Rectangle.southeast(e,i),r=NPMAP3D.NPCoordinate.cartographicToDegrees(t),o=NPMAP3D.NPCoordinate.cartographicToDegrees(i),n=Math.min(o.lat,r.lat),a=Math.min(r.lon,o.lon),s=Math.max(r.lat,o.lat),l=Math.max(o.lon,r.lon);return new NPMAP3D.Geometry.Extent(n,a,s,l)},NPMAP3D.NPCoordinate.cartographicToDegrees=function(e){var t=Cesium.Ellipsoid.WGS84.geodeticSurfaceNormalCartographic(e,t),i=Cesium.Ellipsoid.WGS84.cartesianToCartographic(t),r=Cesium.Math.toDegrees(i.longitude),o=Cesium.Math.toDegrees(i.latitude),n=NPMAP3D.NPUtil.CoordinateHelper.coordinateFromBasemap(r,o);return n},NPMAP3D.NPCoordinate.fromNPCartesian3List=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].lon),t.push(e[i].lat),t.push(e[i].h||0);return Cesium.Cartesian3.fromDegreesArrayHeights(t)},NPMAP3D.DeveloperError=function(e,t){this.name=e,this.message=t},NPMAP3D.DeveloperError.prototype.toString=function(){var e=this.name+": "+this.message;return e},NPMAP3D.Promise=function(){"use strict";this._callbacks=[],this._isdone,this.result},NPMAP3D.Promise.prototype.then=function(e,t){var i,r;return this._isdone?i=e.apply(t,this.result):(i=this,this._callbacks.push(function(){r=e.apply(t,arguments),r&&"function"==typeof r.then&&r.then(i.done,i)})),i},NPMAP3D.Promise.prototype.done=function(){var e,t=this._callbacks.length;for(this.result=arguments,this._isdone=!0,e=0;e<t;e++)this._callbacks[e].apply(null,arguments);this._callbacks=[]},NPMAP3D.Promise.prototype.chain=function(e,t){return p=this,0===e.length?p.done.apply(p,t):e[0].apply(null,t).then(function(){e.splice(0,1),p.chain(e,arguments).then(function(){p.done.apply(p,arguments)})}),p},NPMAP3D.Promise.prototype.when=function(e){function t(e){return function(){a+=1,n[e]=Array.prototype.slice.call(arguments),a===i&&o.done(n)}}var i,r,o=this,n=[],a=0;if(!e||!e.length)return o.done(n),o;for(i=e.length,r=0;r<i;r++)e[r].then(t(r));return o},NPMAP3D.HttpPromise=function(){"use strict"},NPMAP3D.HttpPromise.prototype.get=function(e,t,i){return this._ajax("GET",e,t,i)},NPMAP3D.HttpPromise.prototype.post=function(e,t,i){return this._ajax("POST",e,t,i)},NPMAP3D.HttpPromise.prototype.put=function(e,t,i){return this._ajax("PUT",e,t,i)},NPMAP3D.HttpPromise.prototype["delete"]=function(e,t,i){return this._ajax("DELETE",e,t,i)},NPMAP3D.HttpPromise.prototype._encode=function(e){var t,i,r,o="";if("string"==typeof e)o=e;else{t=encodeURIComponent,i=[];for(r in e)e.hasOwnProperty(r)&&i.push(t(r)+"="+t(e[r]));o=i.join("&")}return o},NPMAP3D.HttpPromise.prototype._newXHR=function(){var e;if(window.XMLHttpRequest)e=new XMLHttpRequest;else if(window.ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){e=new ActiveXObject("Microsoft.XMLHTTP")}return e},NPMAP3D.HttpPromise.prototype._ajax=function(e,t,i,r){function o(){n.abort(),u.done(!0,"time out")}var n,a,s,l,P,u=new NPMAP3D.Promise,h="application/x-www-form-urlencoded",y=1e4;i=i||{},r=r||{};try{n=this._newXHR()}catch(p){return u.done(!0,"no xhr"),u}a=this._encode(i),"GET"===e&&(""!==a&&(t+="?"+a),a=null),n.open(e,t,!0);for(s in r)r.hasOwnProperty(s)&&("content-type"===s.toLowerCase()?h=r[s]:n.setRequestHeader(s,r[s]));return n.setRequestHeader("Content-type",h),y=1e4,y&&(l=setTimeout(o,y)),n.onreadystatechange=function(){y&&clearTimeout(l),4===n.readyState&&(P=!n.status||(n.status<200||n.status>=300)&&304!==n.status,u.done(P,n.responseText),n=null)},n.send(a),u},NPMAP3D.HashMap=function(){"use strict";this.elements=new Array},NPMAP3D.HashMap.prototype.size=function(){return this.elements.length},NPMAP3D.HashMap.prototype.isEmpty=function(){return this.elements.length<1},NPMAP3D.HashMap.prototype.clear=function(){this.elements=new Array},NPMAP3D.HashMap.prototype.put=function(e,t){this.elements.push({key:e,value:t})},NPMAP3D.HashMap.prototype.removeByKey=function(e){var t,i=!1,r=this.elements.length;try{for(t=0;t<r;t++)if(this.elements[t].key==e)return this.elements.splice(t,1),!0}catch(o){i=!1}return i},NPMAP3D.HashMap.prototype.removeByValue=function(e){var t,i=!1,r=this.elements.length;try{for(t=0;t<r;t++)if(this.elements[t].value==e)return this.elements.splice(t,1),!0}catch(o){i=!1}return i},NPMAP3D.HashMap.prototype.removeByValueAndKey=function(e,t){var i,r=!1,o=this.elements.length;try{for(i=0;i<o;i++)if(this.elements[i].value==t&&this.elements[i].key==e)return this.elements.splice(i,1),!0}catch(n){r=!1}return r},NPMAP3D.HashMap.prototype.get=function(e){var t,i=this.elements.length;try{for(t=0;t<i;t++)if(this.elements[t].key==e)return this.elements[t].value}catch(r){return!1}return!1},NPMAP3D.HashMap.prototype.element=function(e){return e<0||e>=this.elements.length?null:this.elements[e]},NPMAP3D.HashMap.prototype.containsKey=function(e){var t,i=!1,r=this.elements.length;try{for(t=0;t<r;t++)this.elements[t].key==e&&(i=!0)}catch(o){i=!1}return i},NPMAP3D.HashMap.prototype.containsValue=function(e){var t,i=!1,r=this.elements.length;try{for(t=0;t<r;t++)this.elements[t].value==e&&(i=!0)}catch(o){i=!1}return i},NPMAP3D.HashMap.prototype.containsObj=function(e,t){var i,r=!1,o=this.elements.length;try{for(i=0;i<o;i++)this.elements[i].value==t&&this.elements[i].key==e&&(r=!0)}catch(n){r=!1}return r},NPMAP3D.HashMap.prototype.values=function(){var e,t=new Array,i=this.elements.length;for(e=0;e<i;e++)t.push(this.elements[e].value);return t},NPMAP3D.HashMap.prototype.valuesByKey=function(e){var t,i=new Array,r=this.elements.length;for(t=0;t<r;t++)this.elements[t].key==e&&i.push(this.elements[t].value);return i},NPMAP3D.HashMap.prototype.keys=function(){var e,t=new Array,i=this.elements.length;for(e=0;e<i;e++)t.push(this.elements[e].key);return t},NPMAP3D.HashMap.prototype.keysByValue=function(e){var t,i=new Array,r=this.elements.length;for(t=0;t<r;t++)e==this.elements[t].value&&i.push(this.elements[t].key);return i},NPMAP3D.HashMap.prototype.keysRemoveDuplicate=function(){var e,t,i=new Array,r=this.elements.length,o=!0,n=i.length;for(e=0;e<r;e++){for(o=!0,t=0;t<n;t++)if(i[t]==this.elements[e].key){o=!1;break}o&&i.push(this.elements[e].key)}return i},NPMAP3D.BaseMap={TDT_ROAD:"tdtRoad",TDT_AERIAL:"tdtAerial",TDT_AERIAL_WITH_LABELS:"tdtAerialWithLabels",TDT_ROAD_WITH_LABELS:"tdtRoadWithLabels",AMAP_ROAD:"amapRoad",AMAP_AERIAL:"amapAerial",BAIDU_ROAD:"baiduRoad",GOOGLE_AERIAL:"googleAerial",GOOGLE_ROAD:"googleRoad",BING_AERIAL:"Aerial",BING_AERIAL_WITH_LABELS:"AerialWithLabels",BING_ROAD:"bingRoad",BING_ORDNANCE_SURVEY:"OrdnanceSurvey",BING_COLLINS_BART:"CollinsBart"},NPMAP3D.Camera=function(e){"use strict";this.camera=e.viewer.camera,this._viewer=e,this._multiplier,this._isFollow,this._firstPoint,this._startTime,this._stopTime,this._entity=void 0,this._position,this._preCartesian,this._trackFlightOverLayLayer,this._trackType,this._trackLine,this._tickListenerHandler},NPMAP3D.Camera.prototype.flyTo=function(e,t){if(!Cesium.defined(e))throw new NPMAP3D.DeveloperError("NPMAP3D.Camera","flyTo() 参数 target 是必须项!");Cesium.defined(t)||(t={}),this._viewer.viewer.flyTo(e._entity,this._getFlyToOpts(t))},NPMAP3D.Camera.prototype.zoomTo=function(e){if(!Cesium.defined(e))throw new NPMAP3D.DeveloperError("NPMAP3D.Camera","zoomTo() 参数 target 是必须项!");this._viewer.viewer.zoomTo(e._entity)},NPMAP3D.Camera.prototype._getFlyToOpts=function(e){var t,i=e.duration,r=e.maximumHeight||-1,o=e.heading||-1,n=e.pitch||-1,a=e.range||-1,s={};return Cesium.defined(i)||(i=3),s.duration=i,r!==-1&&(s.maximumHeight=r),o===-1&&n===-1&&a===-1||(t=new Cesium.HeadingPitchRange,o!==-1&&(t.heading=Cesium.Math.toRadians(o)),n!==-1&&(t.pitch=Cesium.Math.toRadians(n)),a!==-1&&(t.range=a),s.offset=t),s},NPMAP3D.Camera.prototype.trackFlight=function(e,t){this._trackType="flight",this._track(e,t)},NPMAP3D.Camera.prototype.trackDrive=function(e,t){this._trackType="drive",this._track(e,t)},NPMAP3D.Camera.prototype.stopTrack=function(){this._doStop()},NPMAP3D.Camera.prototype.destroy=function(){this._viewer=null},NPMAP3D.Camera.prototype._track=function(e,t){this._trackLine=e,this._getFirstPoint();var i=this._buildOptions(t),r=i.follow?this._firstPoint.h:500,o=this;this.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(this._firstPoint.lon,this._firstPoint.lat,r),orientation:{heading:this.camera.heading,pitch:Cesium.Math.toRadians(-90),roll:this.camera.roll},duration:3,complete:function(){o._trackFlightOverLayLayer=new NPMAP3D.Layer.OverlayLayer("trackFlightOverLayLayer"),o._viewer.addOverlayLayer(o._trackFlightOverLayLayer),o._multiplier=i.multiplier,o._isFollow=i.follow;var e=new Date;o._startTime=Cesium.JulianDate.fromDate(new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours())),o._entity=o._getEntity(i.color,i.width),o._entity.position.setInterpolationOptions({interpolationDegree:1,interpolationAlgorithm:Cesium.LagrangePolynomialApproximation}),o._trackFlightOverLayLayer.addOverlay(o._entity),o._setClock(),o._isFollow&&(o._tickListenerHandler=function(e){var t,i,r=e._currentTime,n=Cesium.JulianDate.equals(r,o._stopTime);n?o._doStop():(t=o._position.getValue(r),Cesium.defined(t)&&(Cesium.defined(o._preCartesian)&&(i=o._getRadian(t,o._preCartesian),o._setCamera(t,i)),o._preCartesian=t))},o._viewer.viewer.clock.onTick.addEventListener(o._tickListenerHandler))}})},NPMAP3D.Camera.prototype._setCamera=function(e,t){var i=Cesium.Math.toRadians(-10),r=50;"flight"===this._trackType&&(i=Cesium.Math.toRadians(-30),r=100),this.camera.lookAt(e,new Cesium.HeadingPitchRange(t,i,r))},NPMAP3D.Camera.prototype._getRadian=function(e,t){var i=this._cartesianToDegrees(e),r=this._cartesianToDegrees(t),o=90-this._calculateRadian(i,r),n=Math.PI+Cesium.Math.toRadians(o);return n},NPMAP3D.Camera.prototype._cartesianToDegrees=function(e){var t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(e),i=Cesium.Math.toDegrees(t.longitude),r=Cesium.Math.toDegrees(t.latitude);return NPMAP3D.NPUtil.CoordinateHelper.coordinateFromBasemap(i,r)},NPMAP3D.Camera.prototype._calculateRadian=function(e,t){return 180*Math.atan2(t.lat-e.lat,t.lon-e.lon)/Math.PI},NPMAP3D.Camera.prototype._doStop=function(){Cesium.defined(this._entity)&&(this._viewer.viewer.clock.onTick.removeEventListener(this._tickListenerHandler),this._isFollow&&this.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),this._viewer.removeOverlayLayer(this._trackFlightOverLayLayer),this._preCartesian=null,this._entity=null,this._multiplier=null,this._isFollow=null,this._firstPoint=null,this._startTime=null,this._stopTime=null,this._position=null,this._trackFlightOverLayLayer.destroy(),this._trackType=null,this._trackLine=null,this._tickListenerHandler=null)},NPMAP3D.Camera.prototype._getFirstPoint=function(){var e,t,i=this._trackLine.paths.length;for(e=0;e<i;e++)t=this._trackLine.paths[e],this._firstPoint=NPMAP3D.NPCoordinate.coordinateTransByBasemap(t[0].lon,t[0].lat),this._firstPoint.h=t[0].h?t[0].h:30},NPMAP3D.Camera.prototype._setClock=function(){var e=this._viewer.viewer.clock;e.startTime=this._startTime.clone(),e.stopTime=this._stopTime.clone(),e.currentTime=this._startTime.clone(),e.clockRange=Cesium.ClockRange.CLAMPED,e.multiplier=this._multiplier},NPMAP3D.Camera.prototype._getEntity=function(e,t){var i=NPMAP3D.NPUtil.getHost(),r=i+"/lib/Cesium/Assets/Models/CesiumMilkTruck.gltf";"flight"===this._trackType&&(r=i+"/lib/Cesium/Assets/Models/Cesium_Air.gltf"),this._position=this._computeTrajectory();var o={availability:new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({start:this._startTime,stop:this._stopTime})]),position:this._position,orientation:new Cesium.VelocityOrientationProperty(this._position),model:{uri:r,minimumPixelSize:32},path:{resolution:1,material:new Cesium.PolylineOutlineMaterialProperty({color:Cesium.Color.fromBytes(e[0],e[1],e[2],255),outlineWidth:1,outlineColor:Cesium.Color.fromBytes(e[0],e[1],e[2],255)}),width:t}};return new Cesium.Entity(o)},NPMAP3D.Camera.prototype._computeTrajectory=function(){var e,t,i,r,o,n,a,s,l,P=new Cesium.SampledPositionProperty,u=this._trackLine.paths.length,h=0;for(e=0;e<u;e++){for(i=this._trackLine.paths[e],r=i.length,t=0;t<r;t++)n=i[t],a=NPMAP3D.NPCoordinate.coordinateTransByBasemap(n.lon,n.lat),l="flight"===this._trackType?Cesium.Cartesian3.fromDegrees(a.lon,a.lat,n.h):Cesium.Cartesian3.fromDegrees(a.lon,a.lat),t>0&&(h+=Cesium.Cartesian3.distance(s,l)),o=Cesium.JulianDate.addSeconds(this._startTime,h,new Cesium.JulianDate),P.addSample(o,l),s=l;this._stopTime=Cesium.JulianDate.addSeconds(this._startTime,h,new Cesium.JulianDate)}return P},NPMAP3D.Camera.prototype._buildOptions=function(e){var t,i,r=e.isLoop||!1,o=e.multiplier||10,n=e.width||5,a=e.color||"#FF0000",s=NPMAP3D.NPUtil.hexToRgb(a),l=e.follow;return t="undefined"==typeof e.follow||l,i={isLoop:r,multiplier:o,color:s,width:n,follow:t}},NPMAP3D.Geometry=function(){"use strict"},NPMAP3D.Geometry.Point=function(e,t){"use strict";NPMAP3D.Geometry.call(this),this.type="point2D",this.lon=Number(e),this.lat=Number(t)},NPMAP3D.inherits(NPMAP3D.Geometry.Point,NPMAP3D.Geometry),NPMAP3D.Geometry.Point3D=function(e,t,i){"use strict";NPMAP3D.Geometry.call(this),this.type="point3D",this.lon=Number(e),this.lat=Number(t),this.h=Number(i)||0},NPMAP3D.inherits(NPMAP3D.Geometry.Point3D,NPMAP3D.Geometry),NPMAP3D.Geometry.Polyline=function(e){"use strict";NPMAP3D.Geometry.call(this),this.type="polyline",this.paths=e},NPMAP3D.inherits(NPMAP3D.Geometry.Polyline,NPMAP3D.Geometry),NPMAP3D.Geometry.Polygon=function(e){"use strict";NPMAP3D.Geometry.call(this),this.type="polygon",this.rings=e},NPMAP3D.inherits(NPMAP3D.Geometry.Polygon,NPMAP3D.Geometry),NPMAP3D.Geometry.Extent=function(e,t,i,r){"use strict";NPMAP3D.Geometry.call(this),this.type="Extent",this.xmin=e,this.ymin=t,this.xmax=i,this.ymax=r,this.extent={xmin:e,ymin:t,xmax:i,ymax:r}},NPMAP3D.inherits(NPMAP3D.Geometry.Extent,NPMAP3D.Geometry),NPMAP3D.Geometry.Circle=function(e,t){"use strict";NPMAP3D.Geometry.call(this),this.type="circle",this.center=e,this.radius=t},NPMAP3D.inherits(NPMAP3D.Geometry.Circle,NPMAP3D.Geometry),NPMAP3D.Layer=function(){"use strict"},NPMAP3D.Layer.MapLayer=function(e,t,i,r){"use strict";if(NPMAP3D.Layer.call(this),this.layerType=r,this.url=e,this.name=t||"地图服务",this._minimumLevel=0,this._maximumLevel=18,this._options=this._buildeOpts(i),this.imageryLayers=new Array,Cesium.defined(this.url))this.imageryLayers[0]=new Cesium.ImageryLayer(this._getOfflineBaseLayer(),this._options);else if("TDTLayer"===this.layerType){var o=this._getOnlineBaseLayer(this._options.style),n=0,a=o.length;for(n;n<a;n++)this.imageryLayers[n]=new Cesium.ImageryLayer(o[n],this._options)}else this.imageryLayers[0]=new Cesium.ImageryLayer(this._getOnlineBaseLayer(),this._options)},NPMAP3D.Layer.MapLayer.prototype.show=function(){1===this.imageryLayers.length&&(this.imageryLayers[0].show=!0)},NPMAP3D.Layer.MapLayer.prototype.hide=function(){1===this.imageryLayers.length&&(this.imageryLayers[0].show=!1)},NPMAP3D.Layer.MapLayer.prototype._buildeOpts=function(e){var t,i=e;return Cesium.defined(e.minimumLevel)&&(this._minimumLevel=e.minimumLevel),Cesium.defined(e.maximumLevel)&&(this._maximumLevel=e.maximumLevel),Cesium.defined(e.rectangle)&&(t=i.rectangle,i.rectangle=Cesium.Rectangle.fromDegrees(t.xmin,t.ymin,t.xmax,t.ymax)),i},NPMAP3D.Layer.MapLayer.prototype._getOfflineBaseLayer=function(){return new Cesium.UrlTemplateImageryProvider({url:this.url,credit:this.name,minimumLevel:this._minimumLevel,maximumLevel:this._maximumLevel})},NPMAP3D.inherits(NPMAP3D.Layer.MapLayer,NPMAP3D.Layer),NPMAP3D.Layer.TDTLayer=function(e,t,i){"use strict";NPMAP3D.Layer.MapLayer.call(this,e,t,i,"TDTLayer")},NPMAP3D.Layer.TDTLayer.prototype._getOnlineBaseLayer=function(e){var t=[];switch(e){case NPMAP3D.BaseMap.TDT_AERIAL:t[0]=this._getAerialLayer();break;case NPMAP3D.BaseMap.TDT_ROAD:t[0]=this._getRoadLayer();break;case NPMAP3D.BaseMap.TDT_ROAD_WITH_LABELS:t[0]=this._getRoadLayer(),t[1]=this._getLabelsLayer();break;default:t[0]=this._getAerialLayer(),t[1]=this._getLabelsLayer()}return t},NPMAP3D.Layer.TDTLayer.prototype._getLabelsLayer=function(){return new Cesium.WebMapTileServiceImageryProvider({url:"http://{s}.tianditu.com/cia_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=cia&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default.jpg",layer:"img",style:"default",format:"tiles",tileMatrixSetID:"w",credit:this.name,subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],maximumLevel:18})},NPMAP3D.Layer.TDTLayer.prototype._getAerialLayer=function(){return new Cesium.WebMapTileServiceImageryProvider({url:"http://{s}.tianditu.com/img_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles",layer:"img",style:"default",format:"tiles",tileMatrixSetID:"w",credit:this.name,subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],maximumLevel:18})},NPMAP3D.Layer.TDTLayer.prototype._getRoadLayer=function(){return new Cesium.WebMapTileServiceImageryProvider({url:"http://{s}.tianditu.com/vec_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=vec&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles",layer:"img",style:"default",
format:"tiles",tileMatrixSetID:"w",credit:this.name,subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],maximumLevel:18})},NPMAP3D.inherits(NPMAP3D.Layer.TDTLayer,NPMAP3D.Layer.MapLayer),NPMAP3D.Layer.GoogleLayer=function(e,t,i){"use strict";NPMAP3D.Layer.MapLayer.call(this,e,t,i,"GoogleLayer")},NPMAP3D.Layer.GoogleLayer.prototype._getOnlineBaseLayer=function(){var e,t=this._options.style;switch(t){case NPMAP3D.BaseMap.GOOGLE_ROAD:e=this._getRoadLayer();break;default:e=this._getAerialLayer()}return e},NPMAP3D.Layer.GoogleLayer.prototype._getAerialLayer=function(){return new Cesium.UrlTemplateImageryProvider({url:"http://{s}.google.cn/vt/lyrs=y@177000000&,highlight:0x35f05296e7142cb9:0xb9625620af0fa98a@1|style:maps&hl=zh-CN&gl=CN&x={x}&y={y}&z={z}&s=Galil&src=app",credit:this.name,subdomains:["mt0","mt1","mt2","mt3"]})},NPMAP3D.Layer.GoogleLayer.prototype._getRoadLayer=function(){return new Cesium.UrlTemplateImageryProvider({url:"http://{s}.google.cn/vt?pb=!1m4!1m3!1i{z}!2i{x}!3i{y}!2m3!1e0!2sm!3i285000000!3m9!2szh-CN!3sCN!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!4e0",credit:this.name,subdomains:["mt0","mt1","mt2","mt3"]})},NPMAP3D.inherits(NPMAP3D.Layer.GoogleLayer,NPMAP3D.Layer.MapLayer),NPMAP3D.Layer.BingLayer=function(e,t,i){"use strict";NPMAP3D.Layer.MapLayer.call(this,e,t,i,"BingLayer")},NPMAP3D.Layer.BingLayer.prototype._getOnlineBaseLayer=function(){var e=this._options.style;return new Cesium.BingMapsImageryProvider({url:"//dev.virtualearth.net",key:"AnnJBLmScQLGhCET-i0R2hNlhBsnyR2pC2EXe4zCJrgWIIqbFToRle3Xwbiig6wK",mapStyle:e})},NPMAP3D.inherits(NPMAP3D.Layer.BingLayer,NPMAP3D.Layer.MapLayer),NPMAP3D.Layer.GaoDeLayer=function(e,t,i){"use strict";NPMAP3D.Layer.MapLayer.call(this,e,t,i,"GaoDeLayer")},NPMAP3D.Layer.GaoDeLayer.prototype._getOnlineBaseLayer=function(){var e,t=this._options.style;switch(t){case NPMAP3D.BaseMap.AMAP_ROAD:e=this._getRoadLayer();break;default:e=this._getAerialLayer()}return e},NPMAP3D.Layer.GaoDeLayer.prototype._getAerialLayer=function(){return new Cesium.UrlTemplateImageryProvider({url:"http://{s}.is.autonavi.com/appmaptile??lang=zh_cn&size=1&scale=1&style=6&L={z}&Z={z}&Y={y}&X={x}",credit:this.name,subdomains:["webst01","webst02","webst03","webst04"],tilingScheme:new Cesium.WebMercatorTilingScheme,maximumLevel:18})},NPMAP3D.Layer.GaoDeLayer.prototype._getRoadLayer=function(){return new Cesium.UrlTemplateImageryProvider({url:"http://{s}.is.autonavi.com/appmaptile??lang=zh_cn&size=1&scale=1&style=7&L={z}&Z={z}&Y={y}&X={x}",credit:this.name,subdomains:["webrd01","webrd02","webrd03","webrd04"],tilingScheme:new Cesium.WebMercatorTilingScheme,maximumLevel:18})},NPMAP3D.inherits(NPMAP3D.Layer.GaoDeLayer,NPMAP3D.Layer.MapLayer),NPMAP3D.Layer.OverlayLayer=function(e){"use strict";if(NPMAP3D.Layer.call(this),this.layerType="OverlayLayer",!Cesium.defined(e))throw new NPMAP3D.DeveloperError("NPMAP3D.Layer.OverlayLayer","name 是必须项!");if(e=NPMAP3D.NPUtil.StringTrim(e),""===e)throw new NPMAP3D.DeveloperError("NPMAP3D.Layer.OverlayLayer","name 不能为空!");this.name=e,this.dataSource=new Cesium.CustomDataSource(this.name)},NPMAP3D.Layer.OverlayLayer.prototype.show=function(){this.dataSource.show=!0},NPMAP3D.Layer.OverlayLayer.prototype.hide=function(){this.dataSource.show=!1},NPMAP3D.Layer.OverlayLayer.prototype.addOverlay=function(e){if(!Cesium.defined(e))throw new NPMAP3D.DeveloperError("NPMAP3D.Layer.OverlayLayer","addOverlay() 参数 overlay 是必须项!");e=e._entity||e,this.dataSource.entities.add(e)},NPMAP3D.Layer.OverlayLayer.prototype.removeOverlay=function(e){if(!Cesium.defined(e))throw new NPMAP3D.DeveloperError("NPMAP3D.Layer.OverlayLayer","removeOverlay() 参数 overlay 是必须项!");if(this.dataSource.entities.contains(e._entity)&&(e=e._entity||e,!this.dataSource.entities.remove(e)))throw new NPMAP3D.DeveloperError("NPMAP3D.Layer.OverlayLayer","removeOverlay() 参数 overlay 删除失败!")},NPMAP3D.Layer.OverlayLayer.prototype.removeAllOverlay=function(){this.dataSource.entities.removeAll()},NPMAP3D.Layer.OverlayLayer.prototype.getOverlayById=function(e){if(!Cesium.defined(e))throw new NPMAP3D.DeveloperError("NPMAP3D.Layer.OverlayLayer","getOverlayById() 参数 id 是必须项!");if(e=NPMAP3D.NPUtil.StringTrim(e),""===e)throw new NPMAP3D.DeveloperError("NPMAP3D.Layer.OverlayLayer","getOverlayById() 参数 id 不能为空!");return this.dataSource.entities.getById(e)},NPMAP3D.Layer.OverlayLayer.prototype.removeOverlayById=function(e){if(!Cesium.defined(e))throw new NPMAP3D.DeveloperError("NPMAP3D.Layer.OverlayLayer","removeOverlayById() id 是必须项!");if(e=NPMAP3D.NPUtil.StringTrim(e),""===e)throw new NPMAP3D.DeveloperError("NPMAP3D.Layer.OverlayLayer","removeOverlayById() id 不能为空!");if(!this.dataSource.entities.removeById(e))throw new NPMAP3D.DeveloperError("NPMAP3D.Layer.OverlayLayer","removeOverlayById() 删除失败!")},NPMAP3D.Layer.OverlayLayer.prototype.destroy=function(){this.layerType=null,this.name=null,this.dataSource=null},NPMAP3D.inherits(NPMAP3D.Layer.OverlayLayer,NPMAP3D.Layer),NPMAP3D.HeatMapLayer=function(e,t,i){var r=CesiumHeatmap.create(e.viewer,t||{north:40.908179104039014,east:115.91325577059447,south:30.008179104039016,west:100.01325577059447},i||{opacity:.3,visible:!0,radius:10});this.setWGS84Data=function(e,t,i){r.setWGS84Data(e||0,t||300,i)}},NPMAP3D.Overlay=function(e,t){"use strict";this._entity=new Cesium.Entity({show:!0,name:e,id:t||NPMAP3D.NPUtil.UUID()}),this.events={},this._entity.overlay=this,this.optsValidation=function(e){!NPMAP3D.NPUtil.isObject(e)},this._setPosition=function(e){if(!NPMAP3D.NPUtil.isObject(e))throw new NPMAP3D.DeveloperError("NPMAP3D.Overlay.Point","参数 point 不正确!");var t=NPMAP3D.NPCoordinate.coordinateTransByBasemap(e.lon,e.lat);this._entity.position=Cesium.Cartesian3.fromDegrees(t.lon,t.lat)}},NPMAP3D.Overlay.prototype.show=function(){this._entity.show=!0},NPMAP3D.Overlay.prototype.hide=function(){this._entity.show=!1},NPMAP3D.Overlay.prototype.setPosition=function(e){Cesium.defined(e)&&(e=NPMAP3D.NPUtil.coordinateTransByBasemap(e.lon,e.lat),this._entity.position=Cesium.Cartesian3.fromDegrees(e.lon,e.lat))},NPMAP3D.Overlay.prototype.getPosition=function(){var e=this._entity.position;if(Cesium.defined(e)){e=e.getValue();var t=Cesium.Cartographic.fromCartesian(e);return e=NPMAP3D.NPMAP3D.NPUtil.CoordinateHelper.coordinateFromBasemap(Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude)),e.h=t.height,e}},NPMAP3D.Overlay.prototype.setDescription=function(e){this._entity.description=e},NPMAP3D.Overlay.prototype.addEventLinsener=function(e,t){this.events[e]=t},NPMAP3D.Overlay.prototype.removeEventLinsener=function(e){this.events[e]&&delete this.events[e]},NPMAP3D.Overlay.Point=function(e,t){"use strict";this._CESIUMTYPE="point",t=NPMAP3D.NPUtil.extend(t,{id:NPMAP3D.NPUtil.UUID(),color:Cesium.Color.RED,pixelSize:10,outlineColor:Cesium.Color.BLACK,outlineWidth:0,show:!0}),NPMAP3D.Overlay.call(this),this._setPosition(e),this._entity[this._CESIUMTYPE]=new Cesium.PointGraphics(t)},NPMAP3D.Overlay.Point.prototype.setColor=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].color=e)},NPMAP3D.Overlay.Point.prototype.getPixelsize=function(){var e=this._entity[this._CESIUMTYPE].pixelSize;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Point.prototype.setPixelsize=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].pixelSize=e)},NPMAP3D.Overlay.Point.prototype.setOutlinecolor=function(e){Cesium.defined(val)&&(this._entity[this._CESIUMTYPE].outlineColor=e)},NPMAP3D.Overlay.Point.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Point.prototype.setOutlinewidth=function(e){Cesium.defined(val)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPMAP3D.Overlay.Point.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Point.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPMAP3D.inherits(NPMAP3D.Overlay.Point,NPMAP3D.Overlay),NPMAP3D.Overlay.Marker=function(e,t){"use strict";this._CESIUMTYPE="billboard";var i=function(){t=NPMAP3D.NPUtil.extend(t,{id:NPMAP3D.NPUtil.UUID(),image:"../assets/images/pin.png",width:20,height:40});var e,i=t.image||"../assets/images/pin.png",r=t.width||20,o=t.height||40;return e={image:i,width:r,height:o}};NPMAP3D.Overlay.call(this),this._setPosition(e),this._entity[this._CESIUMTYPE]=i()},NPMAP3D.Overlay.Marker.prototype.getScale=function(){var e=this._entity[this._CESIUMTYPE].scale;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Marker.prototype.setScale=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].scale=e)},NPMAP3D.Overlay.Marker.prototype.getRotation=function(){var e=this._entity[this._CESIUMTYPE].rotation;if(Cesium.defined(e))return Cesium.Math.toDegrees(e.getValue())},NPMAP3D.Overlay.Marker.prototype.setRotation=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].rotation=Cesium.Math.toRadians(Number(e)))},NPMAP3D.Overlay.Marker.prototype.getImage=function(){var e=this._entity[this._CESIUMTYPE].image;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Marker.prototype.setImage=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].image=e)},NPMAP3D.Overlay.Marker.prototype.getPosition=function(){var e=this._entity[this._CESIUMTYPE].position;if(Cesium.defined(e)){e=e.getValue();var t=Cesium.Cartographic.fromCartesian(e);return e=NPMAP3D.NPUtil.CoordinateHelper.coordinateFromBasema(Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude)),e.h=t.height,e}},NPMAP3D.Overlay.Marker.prototype.setPosition=function(e){Cesium.defined(e)&&(e=NPMAP3D.NPCoordinate.coordinateTransByBasemap(e.lon,e.lat),this._entity[this._CESIUMTYPE].position=Cesium.Cartesian3.fromDegrees(e.lon,e.lat))},NPMAP3D.Overlay.Marker.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Marker.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPMAP3D.Overlay.Marker.prototype.getHorizontalorigin=function(){var e=this._entity[this._CESIUMTYPE].horizontalOrigin;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Marker.prototype.setHorizontalorigin=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].horizontalOrigin=e)},NPMAP3D.Overlay.Marker.prototype.getVerticalorigin=function(){var e=this._entity[this._CESIUMTYPE].verticalOrigin;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Marker.prototype.setVerticalorigin=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].verticalOrigin=e)},NPMAP3D.Overlay.Marker.prototype.getWidth=function(){var e=this._entity[this._CESIUMTYPE].width;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Marker.prototype.setWidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].width=e)},NPMAP3D.Overlay.Marker.prototype.getHeight=function(){var e=this._entity[this._CESIUMTYPE].height;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Marker.prototype.setHeight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].height=e)},NPMAP3D.inherits(NPMAP3D.Overlay.Marker,NPMAP3D.Overlay),NPMAP3D.Overlay.Label=function(e,t){"use strict";this._CESIUMTYPE="label",t=NPMAP3D.NPUtil.extend(t,{id:NPMAP3D.NPUtil.UUID(),text:"netposa",font:"12px SimSun",style:Cesium.LabelStyle.FILL,show:!0,fillColor:Cesium.Color.RED,outlineColor:Cesium.Color.BLACK,outlineWidth:1,scale:1,eyeOffset:Cesium.Cartesian3.ZERO,pixelOffset:Cesium.Cartesian2.ZERO,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.CENTER,heightReference:Cesium.HeightReference.NONE}),NPMAP3D.Overlay.call(this),this._setPosition(e),this._entity[this._CESIUMTYPE]=new Cesium.LabelGraphics(t)},NPMAP3D.Overlay.Label.prototype.getText=function(){var e=this._entity[this._CESIUMTYPE].text;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Label.prototype.setText=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].text=e)},NPMAP3D.Overlay.Label.prototype.getFont=function(){var e=this._entity[this._CESIUMTYPE].font;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Label.prototype.setFont=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].font=e)},NPMAP3D.Overlay.Label.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Label.prototype.setOutlinewidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPMAP3D.Overlay.Label.prototype.getScale=function(){var e=this._entity[this._CESIUMTYPE].scale;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Label.prototype.setScale=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].scale=e)},NPMAP3D.Overlay.Label.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Label.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPMAP3D.Overlay.Label.prototype.getHorizontalorigin=function(){var e=this._entity[this._CESIUMTYPE].horizontalOrigin;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Label.prototype.setHorizontalorigin=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].horizontalOrigin=e)},NPMAP3D.Overlay.Label.prototype.getVerticalorigin=function(){var e=this._entity[this._CESIUMTYPE].verticalOrigin;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Label.prototype.setVerticalorigin=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].verticalOrigin=e)},NPMAP3D.Overlay.Label.prototype.setfillColor=function(e){this._entity[this._CESIUMTYPE].fillColor=e},NPMAP3D.Overlay.Label.prototype.setoutlineColor=function(e){this._entity[this._CESIUMTYPE].outlineColor=e},NPMAP3D.inherits(NPMAP3D.Overlay.Label,NPMAP3D.Overlay),NPMAP3D.Overlay.Polyline=function(e,t){"use strict";this._CESIUMTYPE="polyline",NPMAP3D.Overlay.call(this);var i=!1;t=NPMAP3D.NPUtil.extend(t,{id:NPMAP3D.NPUtil.UUID(),followSurface:!0,width:1,show:!0,material:Cesium.Color.RED,granularity:Cesium.Math.RADIANS_PER_DEGREE});var r,o,n=function(){var t,r,o,n,a=[],s=e.paths.length,l=0,P=0;for(l=0;l<s;l++)for(t=e.paths[l],r=t.length,P=0;P<r;P++)o=t[P],n=NPMAP3D.NPCoordinate.coordinateTransByBasemap(o.lon,o.lat),"2D"===o.type?a.push(n.lon,n.lat):(a.push(n.lon,n.lat,o.h),i||(i=!0));return a};if(!NPMAP3D.NPUtil.isArray(e.paths))throw new NPMAP3D.DeveloperError("NPMAP3D.Overlay.Polyline","参数 polyline 不正确!");if(r=n(),!NPMAP3D.NPUtil.isArray(r)||r.length<4)throw new NPMAP3D.DeveloperError("NPMAP3D.Overlay.Polyline","参数 positions 不正确!");this.optsValidation(t),o=new Cesium.PolylineGraphics(t),i?o.positions=Cesium.Cartesian3.fromDegreesArrayHeights(r):o.positions=Cesium.Cartesian3.fromDegreesArray(r),this._entity[this._CESIUMTYPE]=o},NPMAP3D.Overlay.Polyline.prototype.getWidth=function(){var e=this._entity[this._CESIUMTYPE].width;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Polyline.prototype.setWidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].width=e)},NPMAP3D.Overlay.Polyline.prototype.getFollowsurface=function(){var e=this._entity[this._CESIUMTYPE].followSurface;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Polyline.prototype.setFollowsurface=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].followSurface=e)},NPMAP3D.Overlay.Polyline.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Polyline.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPMAP3D.Overlay.Polyline.prototype.setMaterial=function(e){Cesium.defined(e)&&(e._?this._entity[this._CESIUMTYPE].material=e._:this._entity[this._CESIUMTYPE].material=e)},NPMAP3D.inherits(NPMAP3D.Overlay.Polyline,NPMAP3D.Overlay),NPMAP3D.Overlay.Polygon=function(e,t){"use strict";this._CESIUMTYPE="polygon",NPMAP3D.Overlay.call(this);var i=!1;t=NPMAP3D.NPUtil.extend(t,{id:NPMAP3D.NPUtil.UUID(),height:0,show:!0,fill:!0,outline:!1,outlineColor:Cesium.Color.BLACK,material:Cesium.Color.RED,outlineWidth:1,outlineAlpha:1,stRotation:0,closeTop:!0,closeBottom:!1});var r,o,n=function(){var t,r,o,n,a=[],s=e.rings.length,l=0,P=0;for(l=0;l<s;l++)for(t=e.rings[l],r=t.length,P=0;P<r;P++)o=t[P],n=NPMAP3D.NPCoordinate.coordinateTransByBasemap(o.lon,o.lat),"point2D"===o.type?a.push(n.lon,n.lat):(a.push(n.lon,n.lat,o.h),i||(i=!0));return a};if(!NPMAP3D.NPUtil.isArray(e.rings))throw new NPMAP3D.DeveloperError("NPMAP3D.Overlay.Polygon","参数 polygon 不正确!");if(r=n(),!NPMAP3D.NPUtil.isArray(r)||r.length<6)throw new NPMAP3D.DeveloperError("NPMAP3D.Overlay.Polygon","参数 hierarchy 不正确!");this.optsValidation(t),o=new Cesium.PolygonGraphics(t),i?o.hierarchy=Cesium.Cartesian3.fromDegreesArrayHeights(r):o.hierarchy=Cesium.Cartesian3.fromDegreesArray(r),this._entity[this._CESIUMTYPE]=o},NPMAP3D.Overlay.Polygon.prototype.getHeight=function(){var e=this._entity[this._CESIUMTYPE].height;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Polygon.prototype.setHeight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].height=e)},NPMAP3D.Overlay.Polygon.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Polygon.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPMAP3D.Overlay.Polygon.prototype.getExtrudedheight=function(){var e=this._entity[this._CESIUMTYPE].extrudedHeight;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Polygon.prototype.setExtrudedheight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].extrudedHeight=e)},NPMAP3D.Overlay.Polygon.prototype.getFill=function(){var e=this._entity[this._CESIUMTYPE].fill;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Polygon.prototype.setFill=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].fill=e)},NPMAP3D.Overlay.Polygon.prototype.getOutline=function(){var e=this._entity[this._CESIUMTYPE].outline;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Polygon.prototype.setOutline=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outline=e)},NPMAP3D.Overlay.Polygon.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Polygon.prototype.setOutlinewidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPMAP3D.Overlay.Polygon.prototype.getStrotation=function(){var e=this._entity[this._CESIUMTYPE].stRotation;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Polygon.prototype.setStrotation=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].stRotation=e)},NPMAP3D.Overlay.Polygon.prototype.getPerpositionheight=function(){var e=this._entity[this._CESIUMTYPE].perPositionHeight;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Polygon.prototype.setPerpositionheight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].perPositionHeight=e)},NPMAP3D.Overlay.Polygon.prototype.getClosetop=function(){var e=this._entity[this._CESIUMTYPE].closeTop;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Polygon.prototype.setClosetop=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].closeTop=e)},NPMAP3D.Overlay.Polygon.prototype.getClosebottom=function(){var e=this._entity[this._CESIUMTYPE].closeBottom;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Polygon.prototype.setClosebottom=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].closeBottom=e)},NPMAP3D.Overlay.Polygon.prototype.setMaterial=function(e){Cesium.defined(e)&&(e._?this._entity[this._CESIUMTYPE].material=e._:this._entity[this._CESIUMTYPE].material=e)},NPMAP3D.inherits(NPMAP3D.Overlay.Polygon,NPMAP3D.Overlay),NPMAP3D.Overlay.Model=function(e,t){this._CESIUMTYPE="model",t=NPMAP3D.NPUtil.extend(t,{show:!0,scale:1}),NPMAP3D.Overlay.call(this),this._setPosition(e),this._entity[this._CESIUMTYPE]=new Cesium.ModelGraphics(t)},NPMAP3D.Overlay.Model.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Model.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPMAP3D.inherits(NPMAP3D.Overlay.Model,NPMAP3D.Overlay),NPMAP3D.Overlay.Rectangle=function(e,t){if(this._CESIUMTYPE="rectangle",NPMAP3D.Overlay.call(this),t=NPMAP3D.NPUtil.extend(t,{material:Cesium.Color.GREEN.withAlpha(.5),rotation:0,extrudedHeight:0,height:0,outline:!0,outlineColor:Cesium.Color.YELLOW,closeTop:!0,closeBottom:!0,show:!0,stRotation:0,fill:!0,granularity:Cesium.Math.RADIANS_PER_DEGREE}),this.optsValidation(t),!NPMAP3D.NPUtil.isObject(e))throw new NPMAP3D.DeveloperError("NPMAP3D.Overlay.Point","参数 extent 不正确!");e.left=e.xmin||e.left,e.bottom=e.ymin||e.bottom,e.right=e.xmax||e.right,e.top=e.ymax||e.top;var i=NPMAP3D.NPCoordinate.coordinateTransByBasemap(e.left,e.bottom),r=NPMAP3D.NPCoordinate.coordinateTransByBasemap(e.right,e.top);t.coordinates=Cesium.Rectangle.fromDegrees(i.lon,i.lat,r.lon,r.lat),this._entity[this._CESIUMTYPE]=new Cesium.RectangleGraphics(t)},NPMAP3D.Overlay.Rectangle.prototype.getHeight=function(){var e=this._entity[this._CESIUMTYPE].height;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Rectangle.prototype.setHeight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].height=e)},NPMAP3D.Overlay.Rectangle.prototype.getClosetop=function(){var e=this._entity[this._CESIUMTYPE].closeTop;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Rectangle.prototype.setClosetop=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].closeTop=e)},NPMAP3D.Overlay.Rectangle.prototype.getExtrudedheight=function(){var e=this._entity[this._CESIUMTYPE].extrudedHeight;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Rectangle.prototype.setExtrudedheight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].extrudedHeight=e)},NPMAP3D.Overlay.Rectangle.prototype.getClosebottom=function(){var e=this._entity[this._CESIUMTYPE].closeBottom;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Rectangle.prototype.setClosebottom=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].closeBottom=e)},NPMAP3D.Overlay.Rectangle.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Rectangle.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPMAP3D.Overlay.Rectangle.prototype.getFill=function(){var e=this._entity[this._CESIUMTYPE].fill;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Rectangle.prototype.setFill=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].fill=e)},NPMAP3D.Overlay.Rectangle.prototype.getOutline=function(){var e=this._entity[this._CESIUMTYPE].outline;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Rectangle.prototype.setOutline=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outline=e)},NPMAP3D.Overlay.Rectangle.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Rectangle.prototype.setOutlinewidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPMAP3D.Overlay.Rectangle.prototype.getRotation=function(){var e=this._entity[this._CESIUMTYPE].rotation;if(Cesium.defined(e))return Cesium.Math.toDegrees(e.getValue())},NPMAP3D.Overlay.Rectangle.prototype.setRotation=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].rotation=Cesium.Math.toRadians(Number(e)))},NPMAP3D.Overlay.Rectangle.prototype.getStrotation=function(){var e=this._entity[this._CESIUMTYPE].stRotation;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Rectangle.prototype.setStrotation=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].stRotation=e)},NPMAP3D.Overlay.Rectangle.prototype.setMaterial=function(e){Cesium.defined(e)&&(e._?this._entity[this._CESIUMTYPE].material=e._:this._entity[this._CESIUMTYPE].material=e)},NPMAP3D.inherits(NPMAP3D.Overlay.Rectangle,NPMAP3D.Overlay),NPMAP3D.Overlay.Box=function(e,t){this._CESIUMTYPE="box",t=NPMAP3D.NPUtil.extend(t,{dimensions:Cesium.Cartesian3.ZERO,show:!0,fill:!0,outline:!1,outlineColor:Cesium.Color.BLACK,outlineWidth:1,material:Cesium.Color.GREEN}),NPMAP3D.Overlay.call(this),this._setPosition(e),this._entity[this._CESIUMTYPE]=new Cesium.BoxGraphics(t)},NPMAP3D.Overlay.Box.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Box.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPMAP3D.Overlay.Box.prototype.getFill=function(){var e=this._entity[this._CESIUMTYPE].fill;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Box.prototype.setFill=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].fill=e)},NPMAP3D.Overlay.Box.prototype.getOutline=function(){var e=this._entity[this._CESIUMTYPE].outline;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Box.prototype.setOutline=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outline=e)},NPMAP3D.Overlay.Box.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Box.prototype.setOutlinewidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPMAP3D.inherits(NPMAP3D.Overlay.Box,NPMAP3D.Overlay),NPMAP3D.Overlay.Ellipsoid=function(e,t){if(NPMAP3D.Overlay.call(this),this._CESIUMTYPE="ellipsoid",NPMAP3D.Overlay.call(this),t=NPMAP3D.NPUtil.extend(t,{radii:Cesium.Cartesian3.ZERO,material:Cesium.Color.GREEN,outline:!1,outlineColor:Cesium.Color.BLACK}),this.optsValidation(t),!NPMAP3D.NPUtil.isObject(e))throw new NPMAP3D.DeveloperError("NPMAP3D.Overlay.Ellipsoid","参数 point 不正确!");this._setPosition(e),this._entity[this._CESIUMTYPE]=new Cesium.EllipsoidGraphics(t)},NPMAP3D.Overlay.Ellipsoid.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipsoid.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPMAP3D.Overlay.Ellipsoid.prototype.getFill=function(){var e=this._entity[this._CESIUMTYPE].fill;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipsoid.prototype.setFill=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].fill=e)},NPMAP3D.Overlay.Ellipsoid.prototype.getOutline=function(){var e=this._entity[this._CESIUMTYPE].outline;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipsoid.prototype.setOutline=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outline=e)},NPMAP3D.Overlay.Ellipsoid.prototype.setOutlinecolor=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineColor=e)},NPMAP3D.Overlay.Ellipsoid.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipsoid.prototype.setOutlinewidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPMAP3D.Overlay.Ellipsoid.prototype.getSubdivisions=function(){var e=this._entity[this._CESIUMTYPE].subdivisions;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipsoid.prototype.setSubdivisions=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].subdivisions=e)},NPMAP3D.Overlay.Ellipsoid.prototype.getStackpartitions=function(){var e=this._entity[this._CESIUMTYPE].stackPartitions;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipsoid.prototype.setStackpartitions=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].stackPartitions=e)},NPMAP3D.Overlay.Ellipsoid.prototype.getSlicepartitions=function(){var e=this._entity[this._CESIUMTYPE].slicePartitions;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipsoid.prototype.setSlicepartitions=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].slicePartitions=e)},NPMAP3D.Overlay.Ellipsoid.prototype.setMaterial=function(e){Cesium.defined(e)&&(e._?this._entity[this._CESIUMTYPE].material=e._:this._entity[this._CESIUMTYPE].material=e)},NPMAP3D.inherits(NPMAP3D.Overlay.Ellipsoid,NPMAP3D.Overlay),NPMAP3D.Overlay.Ellipse=function(e,t){this._CESIUMTYPE="ellipse",t=NPMAP3D.NPUtil.extend(t,{semiMinorAxis:15e4,semiMajorAxis:3e5,extrudedHeight:0,rotation:Cesium.Math.toRadians(0),material:Cesium.Color.BLUE.withAlpha(.5),outline:!0}),NPMAP3D.Overlay.call(this),this._setPosition(e),this._entity[this._CESIUMTYPE]=new Cesium.EllipseGraphics(t)},NPMAP3D.Overlay.Ellipse.prototype.getHeight=function(){var e=this._entity[this._CESIUMTYPE].height;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipse.prototype.setHeight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].height=e)},NPMAP3D.Overlay.Ellipse.prototype.getExtrudedheight=function(){var e=this._entity[this._CESIUMTYPE].extrudedHeight;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipse.prototype.setExtrudedheight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].extrudedHeight=e)},NPMAP3D.Overlay.Ellipse.prototype.getRotation=function(){var e=this._entity[this._CESIUMTYPE].rotation;if(Cesium.defined(e))return Cesium.Math.toDegrees(e.getValue())},NPMAP3D.Overlay.Ellipse.prototype.setRotation=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].rotation=Cesium.Math.toRadians(Number(e)))},NPMAP3D.Overlay.Ellipse.prototype.getSemiminoraxis=function(){var e=this._entity[this._CESIUMTYPE].semiMinorAxis;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipse.prototype.setSemiminoraxis=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].semiMinorAxis=e)},NPMAP3D.Overlay.Ellipse.prototype.getSemimajoraxis=function(){var e=this._entity[this._CESIUMTYPE].semiMajorAxis;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipse.prototype.setSemimajoraxis=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].semiMajorAxis=e)},NPMAP3D.Overlay.Ellipse.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipse.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPMAP3D.Overlay.Ellipse.prototype.getFill=function(){var e=this._entity[this._CESIUMTYPE].fill;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipse.prototype.setFill=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].fill=e)},NPMAP3D.Overlay.Ellipse.prototype.getOutline=function(){var e=this._entity[this._CESIUMTYPE].outline;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipse.prototype.setOutline=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outline=e)},NPMAP3D.Overlay.Ellipse.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipse.prototype.setOutlinewidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPMAP3D.Overlay.Ellipse.prototype.getNumberofverticallines=function(){var e=this._entity[this._CESIUMTYPE].numberOfVerticalLines;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipse.prototype.setNumberofverticallines=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].numberOfVerticalLines=e)},NPMAP3D.Overlay.Ellipse.prototype.getStrotation=function(){var e=this._entity[this._CESIUMTYPE].stRotation;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Ellipse.prototype.setStrotation=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].stRotation=e)},NPMAP3D.Overlay.Ellipse.prototype.setMaterial=function(e){Cesium.defined(e)&&(e._?this._entity[this._CESIUMTYPE].material=e._:this._entity[this._CESIUMTYPE].material=e);
},NPMAP3D.inherits(NPMAP3D.Overlay.Ellipse,NPMAP3D.Overlay),NPMAP3D.Overlay.Wall=function(e,t){this._CESIUMTYPE="wall";for(var i=[],r=[],o=e.length-1;o>=0;o--)i.push(1e5),r.push(0);t=NPMAP3D.NPUtil.extend(t,{maximumHeights:i,minimumHeights:r,material:Cesium.Color.GREEN,outline:!0,outlineColor:Cesium.Color.RED}),NPMAP3D.Overlay.call(this);var n=new Cesium.WallGraphics(t);n.positions=NPMAP3D.NPCoordinate.fromNPCartesian3List(e),this._entity[this._CESIUMTYPE]=n},NPMAP3D.Overlay.Wall.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Wall.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPMAP3D.Overlay.Wall.prototype.getFill=function(){var e=this._entity[this._CESIUMTYPE].fill;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Wall.prototype.setFill=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].fill=e)},NPMAP3D.Overlay.Wall.prototype.getOutline=function(){var e=this._entity[this._CESIUMTYPE].outline;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Wall.prototype.setOutline=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outline=e)},NPMAP3D.Overlay.Wall.prototype.setOutlinecolor=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineColor=e)},NPMAP3D.Overlay.Wall.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPMAP3D.Overlay.Wall.prototype.setOutlinewidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPMAP3D.Overlay.Wall.prototype.setMaterial=function(e){Cesium.defined(e)&&(e._?this._entity[this._CESIUMTYPE].material=e._:this._entity[this._CESIUMTYPE].material=e)},NPMAP3D.inherits(NPMAP3D.Overlay.Wall,NPMAP3D.Overlay),NPMAP3D.Overlay.InfoWindow=function(e,t,i,r){r=r||{infoSize:{h:"160px",w:""}};var o=window.document.createElement("div");o.className="ol-popup",o.style.zIndex=1e3,document.getElementById(t.container).appendChild(o),o.appendChild(i);var n=t.viewer;e=NPMAP3D.NPUtil.CoordinateHelper.coordinateTransByBasemap(e.lon,e.lat);var a=t.getWindowCoordinates({x:e.lon,y:e.lat});o.style.left=a.x-50+"px",o.style.top=a.y-170+"px",o.style.height="160px",e=Cesium.Cartesian3.fromDegrees(e.lon,e.lat);var s=new Cesium.Entity({position:e,show:!1,point:{color:Cesium.Color.WHITE,outlineColor:Cesium.Color.RED,outlineWidth:1,pixelSize:6}});n.entities.add(s);var l=n.scene.postRender.addEventListener(function(){var e=Cesium.SceneTransforms.wgs84ToWindowCoordinates(n.scene,s.position.getValue(Cesium.JulianDate.now()));try{a.x===e.x&&a.y===e.y||(o.style.left=a.x-50+"px",o.style.top=a.y-170+"px",a=e)}catch(t){}});this.show=function(){o.style.display=""},this.hide=function(){o.style.display="none"},this.getContainer=function(){return o},this.remove=function(){document.getElementById(t.container).removeChild(o),l.call(),n.entities.remove(s)}},NPMAP3D.inherits(NPMAP3D.Overlay.InfoWindow,NPMAP3D.Overlay),NPMAP3D.ModelLoader=function(e){this._viewer=e,this._collection=new Cesium.PrimitiveCollection},NPMAP3D.ModelLoader.prototype.loadModel=function(e,t){this._collection.add(this._getModel(e,t)),this._viewer.viewer.scene.groundPrimitives.add(this._collection)},NPMAP3D.ModelLoader.prototype.loadModels=function(e){if(!Cesium.defined(e))throw new NPMAP3D.DeveloperError("NPMAP3D.ModelLoader","loadModels() 参数 modelArray 是必须项!");if(!NPMAP3D.NPUtil.isArray(e))throw new NPMAP3D.DeveloperError("NPMAP3D.ModelLoader","loadModels() 参数 modelArray 必须是数组!");var t,i=e.length-1;for(i;i>=0;i--)t=e[i],this._collection.add(this._getModel(t.url,t.position));this._viewer.viewer.scene.groundPrimitives.add(this._collection)},NPMAP3D.ModelLoader.prototype.removeAll=function(){this._collection.length>0&&this._collection.removeAll()},NPMAP3D.ModelLoader.prototype.show=function(){this._collection.show=!0},NPMAP3D.ModelLoader.prototype.hide=function(){this._collection.show=!1},NPMAP3D.ModelLoader.prototype.destroy=function(){this._viewer=null,this._collection=null},NPMAP3D.ModelLoader.prototype._getModel=function(e,t){if(!Cesium.defined(e))throw new NPMAP3D.DeveloperError("NPMAP3D.ModelLoader","loadModel() 参数 url 是必须项!");if(!Cesium.defined(t))throw new NPMAP3D.DeveloperError("NPMAP3D.ModelLoader","loadModel() 参数 position 是必须项!");var i=NPMAP3D.NPUtil.CoordinateHelper.coordinateTransByBasemap(t.lon,t.lat),r=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(i.lon,i.lat,0)),o=Cesium.Model.fromGltf({url:e,modelMatrix:r,scale:40});return o},NPMAP3D.DataSource=function(){"use strict"},NPMAP3D.DataSource.BuildingDataSource=function(){"use strict";NPMAP3D.DataSource.call(this)},NPMAP3D.DataSource.BuildingDataSource.prototype.load=function(e,t){function i(){return o.get(e,{})}var r=new NPMAP3D.Promise,o=new NPMAP3D.HttpPromise,n=NPMAP3D.NPUtil.hexToRgb("#F9F6F0"),a=1,s=this;return i().then(function(e,i){var o,l,P,u,h,y,p,c,M=[];if(!e){if(""===i)return;for(o=JSON.parse(i),l=1,P=o.length;l<P;l++)u=o[l],h=s._getOpts(u),y=new Cesium.PolygonGeometry(h),p=new Cesium.GeometryInstance({geometry:y,id:u.id}),M.push(p);c=new Cesium.Primitive({geometryInstances:M,cull:!1,appearance:new Cesium.MaterialAppearance({material:new Cesium.Material({fabric:{type:"Color",uniforms:{color:Cesium.Color.fromBytes(n[0],n[1],n[2],255*a)}}})})}),c.instances=M,r.done(!1,t,c)}}),r},NPMAP3D.DataSource.BuildingDataSource.prototype._getOpts=function(e){var t,i,r,o,n=e.polygon,a=n.positions.cartographicDegrees;if(!NPMAP3D.NPUtil.isArray(a)||a.length<=2)throw new NPMAP3D.DeveloperError("NPMAP3D.BuildingDataSource","参数 cartographicDegrees 不正确!"+e.id);return t=this._coordinateTransHeights(a),i=n.extrudedHeight,r=i.number,o={polygonHierarchy:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(t)),perPositionHeight:!0,extrudedHeight:r}},NPMAP3D.DataSource.BuildingDataSource.prototype._coordinateTransHeights=function(e){var t,i,r,o,n,a=e.length,s=new Array;for(t=0;t<a;t+=3)i=e[t],r=e[t+1],o=e[t+2],n=NPMAP3D.NPUtil.CoordinateHelper.coordinateTransByBasemap(i,r),s.push(n.lon),s.push(n.lat),s.push(o);return s},NPMAP3D.inherits(NPMAP3D.DataSource.BuildingDataSource,NPMAP3D.DataSource),NPMAP3D.DataSource.BuildingDataSourceEntity=function(e){"use strict";NPMAP3D.DataSource.call(this),this._callback=e},NPMAP3D.DataSource.BuildingDataSourceEntity.prototype.load=function(e,t){function i(){return o.get(e,{})}var r=new NPMAP3D.Promise,o=new NPMAP3D.HttpPromise,n=this,a=this;return i().then(function(e,i){var o,s,l,P,u,h,y,p;if(!e){for(o=JSON.parse(i),y=new Cesium.CustomDataSource("building_"+t),s=1,l=o.length;s<l;s++)P=o[s],u=P.polygon.positions.cartographicDegrees,h=n._coordinateTransHeights(u),p=n._getEntity(P,h),p.overlay=P,p.overlay._entity=p,p.overlay.events={},p.overlay.events.click=a._callback,y.entities.add(p);r.done(!1,t,y)}}),r},NPMAP3D.DataSource.BuildingDataSourceEntity.prototype._getEntity=function(e,t){var i=new Cesium.Entity({id:"building_"+NPMAP3D.NPUtil.UUID()});return i.polygon=this._getPolygonGraphics(e,t),e.description=""!==e.description?e.description:"未命名",i.description="<span>名称："+e.description+"</span>",i},NPMAP3D.DataSource.BuildingDataSourceEntity.prototype._getPolygonGraphics=function(e,t){var i=this._getPolygonOpts(e),r=new Cesium.PolygonGraphics(i);return r.hierarchy=Cesium.Cartesian3.fromDegreesArrayHeights(t),r},NPMAP3D.DataSource.BuildingDataSourceEntity.prototype._getWallGraphics=function(e){var t=NPMAP3D.NPUtil.hexToRgb("#F9F6F0"),i=1;return new Cesium.WallGraphics({positions:Cesium.Cartesian3.fromDegreesArrayHeights(e),material:Cesium.Color.fromBytes(t[0],t[1],t[2],255*i)})},NPMAP3D.DataSource.BuildingDataSourceEntity.prototype._getTopGraphics=function(e,t){var i=this._getTopOpts(e),r=new Cesium.PolygonGraphics(i);return r.hierarchy=Cesium.Cartesian3.fromDegreesArrayHeights(t),r},NPMAP3D.DataSource.BuildingDataSourceEntity.prototype._getPolygonOpts=function(e){var t,i=e.polygon,r=i.extrudedHeight,o=r.number,n=NPMAP3D.NPUtil.hexToRgb("#F9F6F0"),a=1;return t={id:e.id,perPositionHeight:!0,extrudedHeight:o,material:Cesium.Color.fromBytes(n[0],n[1],n[2],255*a),closeTop:!1,closeBottom:!0}},NPMAP3D.DataSource.BuildingDataSourceEntity.prototype._getTopOpts=function(e){var t,i=(e.polygon,NPMAP3D.NPUtil.hexToRgb("#CCCCCC")),r=1;return t={height:50,material:Cesium.Color.fromBytes(i[0],i[1],i[2],255*r),closeTop:!1,closeBottom:!0}},NPMAP3D.DataSource.BuildingDataSourceEntity.prototype._coordinateTransHeights=function(e){var t,i,r,o,n,a=e.length,s=new Array;for(t=0;t<a;t+=3)i=e[t],r=e[t+1],o=e[t+2],n=NPMAP3D.NPUtil.CoordinateHelper.coordinateTransByBasemap(i,r),s.push(n.lon),s.push(n.lat),s.push(o);return s},NPMAP3D.inherits(NPMAP3D.DataSource.BuildingDataSourceEntity,NPMAP3D.DataSource),NPMAP3D.Building.LoadBuilding=function(e,t,i){"use strict";this._url=t,this._events={},this._visiblity=!0,this._viewer=e,this._T_C_DISTANCE=i&&i.maxDistance?i.maxDistance:3e3,this._CAMERA_HEIGHT=i&&i.maxHeight?i.maxHeight:5e3,this.ORIGIN_LON=-180,this._isLoad=!1,this.ORIGIN_LAT=90,this.MAP_LEVEL=16,this.coef=360/Math.pow(2,this.MAP_LEVEL),this.hashMap=new NPMAP3D.HashMap,this.camera=this._viewer.viewer.camera,this.scene=this._viewer.viewer.scene,this.ellipsoid=this._viewer.viewer.scene.globe.ellipsoid,this.isInteraction=!1},NPMAP3D.Building.LoadBuilding.prototype.addEventListener=function(e,t){"click"===e&&(this._clearAll(),this.isInteraction=!0,this._events.click=t,this._isLoad&&this._loadBuildingData())},NPMAP3D.Building.LoadBuilding.prototype.removeEventListener=function(e){"click"===e&&(this._events.click=null,this._clearAll(),this.isInteraction=!1,this._loadBuildingData())},NPMAP3D.Building.LoadBuilding.prototype.load=function(){this._isLoad=!0,this.camera.changed.addEventListener(this._loadBuildingData,this),this._loadBuildingData()},NPMAP3D.Building.LoadBuilding.prototype.show=function(){this._visiblity=!0,this._isLoad&&this._loadBuildingData()},NPMAP3D.Building.LoadBuilding.prototype.hide=function(){this._visiblity=!1,this._clearAll()},NPMAP3D.Building.LoadBuilding.prototype.destory=function(){this._visiblity=!1,this._clearAll(),this.camera.changed.removeEventListener(this._loadBuildingData,this)},NPMAP3D.Building.LoadBuilding.prototype._clearAll=function(){this.isInteraction?this._remoreBuildingDs():this._remoreBuildingPt(),this.hashMap.clear()},NPMAP3D.Building.LoadBuilding.prototype._loadBuildingData=function(){if(this._visiblity){var e,t,i,r,o,n,a=this.ellipsoid.cartesianToCartographic(this.camera.position).height;if(a>this._CAMERA_HEIGHT)return void this._clearAll();e=this._cameraCenterToWebMoctor(),t=this._cameraViewRectToTileScope(),i=t.minRow,r=t.maxRow,o=t.minCol,n=t.maxCol,this.hashMap=this._remove(i,r,o,n),this._loadBuildingTiles(i,r,o,n,e)}},NPMAP3D.Building.LoadBuilding.prototype._remoreBuildingDs=function(){var e,t=this.hashMap.values(),i=t.length;for(e=0;e<i;e++)this._viewer.viewer.dataSources.remove(t[e].dataSource,!0)},NPMAP3D.Building.LoadBuilding.prototype._remoreBuildingPt=function(){var e,t=this.hashMap.values(),i=t.length;for(e=0;e<i;e++)this._viewer.viewer.scene.primitives.remove(t[e].dataSource,!0)},NPMAP3D.Building.LoadBuilding.prototype._loadBuildingTiles=function(e,t,i,r,o){var n,a,s,l,P,u,h,y,p,c;for(n=e;n<t+1;n++)for(a=i;a<r+1;a++)s=n*this.coef+this.ORIGIN_LON,l=(n+1)*this.coef+this.ORIGIN_LON,P=this.ORIGIN_LAT-(a+1)*this.coef,u=this.ORIGIN_LAT-a*this.coef,h=_3dhelper.degreeToWebMoctor((s+l)/2,(P+u)/2),y=Math.sqrt(Math.pow(o.lon-h.lon,2)+Math.pow(o.lat-h.lat,2)),p=this.MAP_LEVEL+"_"+n+"_"+a,y>this._T_C_DISTANCE||(c=this._url+"/"+p+".czml",this.hashMap.containsKey(p)||(this.isInteraction?this._loadBuildingTileForEntity(c,p):this._loadBuildingTile(c,p)))},NPMAP3D.Building.LoadBuilding.prototype._loadBuildingTile=function(e,t){function i(){return o.load(e,t)}var r=new NPMAP3D.Promise,o=new NPMAP3D.DataSource.BuildingDataSource,n=this;r.when([i()]).then(function(e){var t,i,r,o;t=e[0],i=t[1],r=t[2],r.key=i;for(var a=0;a<n.scene.primitives.length;a++)if(n.scene.primitives.get(a).key===i)return;n.scene.primitives.add(r),o={dataSource:r,state:!1},n.hashMap.put(i,o),r=null})},NPMAP3D.Building.LoadBuilding.prototype._loadBuildingTileForEntity=function(e,t){function i(){return o.load(e,t)}var r=new NPMAP3D.Promise,o=new NPMAP3D.DataSource.BuildingDataSourceEntity(this._events.click),n=this;r.when([i()]).then(function(e){var t,i=e[0],r=i[1],o=i[2];o.key=r;for(var a=0;a<n._viewer.viewer.dataSources.length;a++)if(n._viewer.viewer.dataSources.get(a).key===r)return;n._viewer.viewer.dataSources.add(o),t={dataSource:o,state:!1},n.hashMap.put(r,t)})},NPMAP3D.Building.LoadBuilding.prototype._cameraCenterToWebMoctor=function(){var e=this.camera.positionWC,t=this.ellipsoid.cartesianToCartographic(e),i=(this.ellipsoid.cartographicToCartesian(t),Cesium.Math.toDegrees(t.longitude)),r=Cesium.Math.toDegrees(t.latitude);return _3dhelper.degreeToWebMoctor(i,r)},NPMAP3D.Building.LoadBuilding.prototype._cameraViewRectToTileScope=function(){var e={minRow:0,maxRow:0,minCol:0,maxCol:0},t=new Cesium.Rectangle,i=this.camera.computeViewRectangle(Cesium.Ellipsoid.WGS84,t),r=Cesium.Math.toDegrees(i.west),o=Cesium.Math.toDegrees(i.north),n=Cesium.Math.toDegrees(i.east),a=Cesium.Math.toDegrees(i.south),s=Math.floor((r-this.ORIGIN_LON)/this.coef),l=Math.ceil((n-this.ORIGIN_LON)/this.coef),P=Math.floor((this.ORIGIN_LAT-a)/this.coef),u=Math.ceil((this.ORIGIN_LAT-o)/this.coef),h=1;return l-s<4&&(h=2),s-=h,l+=h,u-=h,P+=h,e.minRow=s,e.maxRow=l,e.minCol=u,e.maxCol=P,e},NPMAP3D.Building.LoadBuilding.prototype._remove=function(e,t,i,r){var o,n,a,s,l=new NPMAP3D.HashMap,P=this.hashMap.keys();for(o=e;o<t+1;o++)for(n=i;n<r+1;n++){a=this.MAP_LEVEL+"_"+o+"_"+n;var u=this._cameraCenterToWebMoctor(),h=o*this.coef+this.ORIGIN_LON,y=(o+1)*this.coef+this.ORIGIN_LON,p=this.ORIGIN_LAT-(n+1)*this.coef,c=this.ORIGIN_LAT-n*this.coef,M=_3dhelper.degreeToWebMoctor((h+y)/2,(p+c)/2),d=Math.sqrt(Math.pow(u.lon-M.lon,2)+Math.pow(u.lat-M.lat,2));d>this._T_C_DISTANCE&&this.hashMap.containsKey(a)&&(this.hashMap.get(a).state=!1),this.hashMap.containsKey(a)&&(this.hashMap.get(a).state=!0)}for(o=P.length-1;o>=0;o--)s=P[o],this.hashMap.get(s).state?(this.hashMap.get(s).state=!1,l.put(s,this.hashMap.get(s))):this.isInteraction?this._viewer.viewer.dataSources.remove(this.hashMap.get(s).dataSource):this.scene.primitives.remove(this.hashMap.get(s).dataSource);return l},NPMAP3D.Trajectory=function(e){"use strict";this.camera=new NPMAP3D.Camera(e)},NPMAP3D.Trajectory.prototype.play=function(e,t){this.camera.trackDrive(e,t)},NPMAP3D.Trajectory.prototype.stop=function(){this.camera.stopTrack()},NPMAP3D.Tools=NPMAP3D.Tools||{},NPMAP3D.Tools.DrawingTool=function(e,t){this._drawHelper=new DrawHelper(e.viewer,t),this._viewer=e.viewer,this._drawCollection=new Cesium.PrimitiveCollection,this._viewer.scene.primitives.add(this._drawCollection)},NPMAP3D.Tools.DrawingTool.prototype.setMode=function(e,t,i){switch(e){case NPMAP3D.DrawingMode.MARKER:this.drawMarker(t,i);break;case NPMAP3D.DrawingMode.POLYLINE:this.drawPolyline(t,i);break;case NPMAP3D.DrawingMode.POLYGON:this.drawPolygon(t,i);break;case NPMAP3D.DrawingMode.CIRCLE:this.drawCircle(t,i);break;case NPMAP3D.DrawingMode.EXTENT:this.drawExtent(t,i);break;default:this.drawClean()}},NPMAP3D.Tools.DrawingTool.prototype.drawClean=function(){for(var e,t,i=this._drawCollection.length,e=i-1;e>=0;e--){t=this._drawCollection.get(e);try{t.setEditMode(!1)}catch(r){}this._viewer.scene.primitives.remove(t)}this._drawCollection._primitives=[],this._drawHelper.stopDrawing()},NPMAP3D.Tools.DrawingTool.prototype.drawCircle=function(e,t){var i=this;this._drawHelper.startDrawingCircle({callback:function(t){var r,o=t.center,n=t.radius,a=t.scene,s=new DrawHelper.CirclePrimitive({center:o,radius:n,material:Cesium.Material.fromType(Cesium.Material.RimLightingType)});"function"==typeof e&&(r=new NPMAP3D.Geometry.Circle(NPMAP3D.NPCoordinate.cartesianToPointGeo(o),n),e(r)),a.primitives.add(s),i._drawCollection.add(s),s.setEditable(),s.addListener("onEdited",function(t){"function"==typeof e&&(r=new NPMAP3D.Geometry.Circle(NPMAP3D.NPCoordinate.cartesianToPointGeo(t.center),t.radius),e(r))})}})},NPMAP3D.Tools.DrawingTool.prototype.drawExtent=function(e,t){var i=this;this._drawHelper.startDrawingExtent({callback:function(t){var r,o=t.extent,n=t.scene,a=new DrawHelper.ExtentPrimitive({extent:o,material:Cesium.Material.fromType(Cesium.Material.RimLightingType)});"function"==typeof e&&(r=NPMAP3D.NPCoordinate.extentToExtentGeo(o),e(r)),n.primitives.add(a),i._drawCollection.add(a),a.setEditable(),a.addListener("onEdited",function(t){"function"==typeof e&&(r=NPMAP3D.NPCoordinate.extentToExtentGeo(t.extent),e(r))})}})},NPMAP3D.Tools.DrawingTool.prototype.drawPolygon=function(e,t){var i=this;this._drawHelper.startDrawingPolygon({callback:function(t){var r,o=t.positions,n=t.scene,a=new DrawHelper.PolygonPrimitive({positions:o,material:Cesium.Material.fromType(Cesium.Material.RimLightingType)});"function"==typeof e&&(r=NPMAP3D.NPCoordinate.positionsToPolygonGeo(o),e(r)),n.primitives.add(a),i._drawCollection.add(a),a.setEditable(),a.addListener("onEdited",function(t){o=t.positions,"function"==typeof e&&(r=NPMAP3D.NPCoordinate.positionsToPolygonGeo(o),e(r))})}})},NPMAP3D.Tools.DrawingTool.prototype.drawPolyline=function(e,t){var i=this;this._drawHelper.startDrawingPolyline({callback:function(t){var r,o=t.positions,n=t.scene,a=new DrawHelper.PolylinePrimitive({positions:o,width:5,material:Cesium.Material.fromType(Cesium.Material.RimLightingType),geodesic:!0});"function"==typeof e&&(r=NPMAP3D.NPCoordinate.positionsToPolylineGeo(o),e(r)),n.primitives.add(a),i._drawCollection.add(a),a.setEditable(),a.addListener("onEdited",function(t){o=t.positions,"function"==typeof e&&(r=NPMAP3D.NPCoordinate.positionsToPolylineGeo(o),e(r))})}})},NPMAP3D.Tools.DrawingTool.prototype.drawMarker=function(e,t){var i=this;this._drawHelper.startDrawingMarker({callback:function(t){var r,o=t.position,n=t.scene,a=new Cesium.BillboardCollection;"function"==typeof e&&(r=NPMAP3D.NPCoordinate.cartesianToPointGeo(o),e(r)),n.primitives.add(a);var s=NPMAP3D.NPUtil.getHost()+"lib/Cesium/Assets",l=a.add({show:!0,position:o,pixelOffset:new Cesium.Cartesian2(0,0),eyeOffset:new Cesium.Cartesian3(0,0,0),horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.CENTER,scale:1,image:s+"/img/glyphicons_242_google_maps.png",color:new Cesium.Color(1,1,1,1)});i._drawCollection.add(a),l.setEditable(),l.addListener("dragEnd",function(t){o=t.positions,"function"==typeof e&&(r=NPMAP3D.NPCoordinate.cartesianToPointGeo(o),e(r))})}})},NPMAP3D.DrawingMode={MARKER:"drawMarker",POLYLINE:"drawPolyline",POLYGON:"drawPolygon",CIRCLE:"drawCircle",EXTENT:"drawExtent",CLEAN:"clean"},NPMAP3D.Tools=NPMAP3D.Tools||{},NPMAP3D.Tools.MeasureTool=function(e,t){this.drawHelper=new DrawHelper(e.viewer,t),this.viewer=e.viewer},NPMAP3D.Tools.MeasureTool.prototype.setMode=function(e,t){switch(e){case NPMAP3D.MeasureMode.AREA:this.measureArea(t);break;case NPMAP3D.MeasureMode.DISTANCE:this.measureDistance(t);break;default:this.measureClean()}},NPMAP3D.Tools.MeasureTool.prototype.measureDistance=function(e){this.drawHelper.measureDistance(e)},NPMAP3D.Tools.MeasureTool.prototype.measureArea=function(e){this.drawHelper.measureArea(e)},NPMAP3D.Tools.MeasureTool.prototype.measureClean=function(){this.drawHelper.stopDrawing()},NPMAP3D.MeasureMode={DISTANCE:"measureDistance",AREA:"measureArea",CLEAN:"measureClean"},NPMAP3D.PolylineArrowMaterialProperty=function(e){this._=new Cesium.PolylineArrowMaterialProperty(e||Cesium.Color.WHITE)},NPMAP3D.PolylineOutlineMaterialProperty=function(e){e=e||{color:Cesium.Color.WHITE,outlineColor:Cesium.Color.BLACK,outlineWidth:1},this._=new Cesium.PolylineOutlineMaterialProperty(e)};